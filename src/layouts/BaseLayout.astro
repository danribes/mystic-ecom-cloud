---
/**
 * Base Layout Component (T233)
 *
 * Main layout wrapper for all pages.
 * Includes header, footer, SEO, Organization structured data, and global styles.
 */

import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import SkipLink from '@/components/SkipLink.astro';
import KeyboardNavDetector from '@/components/KeyboardNavDetector.astro';
import A11yAnnouncer from '@/components/A11yAnnouncer.astro';
import SEO from '@/components/SEO.astro';
import { getOrganizationData } from '@/lib/siteConfig';
import { generateOrganizationSchema } from '@/lib/structuredData';
import '@/styles/global.css';

// Generate Organization structured data for Schema.org
const organizationSchema = generateOrganizationSchema(getOrganizationData());

interface Props {
  /**
   * Page title (will be appended with site name)
   */
  title: string;

  /**
   * Page description for SEO
   */
  description?: string;

  /**
   * Keywords for SEO
   */
  keywords?: string;

  /**
   * Open Graph image URL
   */
  ogImage?: string;

  /**
   * Open Graph type
   */
  ogType?: 'website' | 'article' | 'profile' | 'book' | 'music' | 'video';

  /**
   * Article metadata (for blog posts, etc.)
   */
  publishedTime?: string;
  modifiedTime?: string;
  articleAuthor?: string;
  articleSection?: string;
  articleTags?: string[];

  /**
   * Disable search engine indexing
   */
  noindex?: boolean;

  /**
   * Disable following links
   */
  nofollow?: boolean;
}

const {
  title,
  description,
  keywords,
  ogImage,
  ogType = 'website',
  publishedTime,
  modifiedTime,
  articleAuthor,
  articleSection,
  articleTags,
  noindex = false,
  nofollow = false,
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <SEO
      title={title}
      description={description}
      keywords={keywords}
      ogImage={ogImage}
      ogType={ogType}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
      articleAuthor={articleAuthor}
      articleSection={articleSection}
      articleTags={articleTags}
      noindex={noindex}
      nofollow={nofollow}
    />

    <!-- Organization Structured Data (Schema.org JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />

    <!-- Additional head content (e.g., page-specific structured data) -->
    <slot name="head" />

    <!-- Favicon - Multiple formats for best browser/search engine support -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest" />
  </head>
  <body class="flex min-h-screen flex-col">
    <!-- Skip Link for Keyboard Navigation -->
    <SkipLink />

    <!-- Keyboard Navigation Detector -->
    <KeyboardNavDetector />

    <!-- Accessibility Announcer for Screen Readers -->
    <A11yAnnouncer />

    <Header />

    <main id="main-content" class="flex-1 py-2xl" role="main">
      <slot />
    </main>

    <Footer />
  </body>
</html>
