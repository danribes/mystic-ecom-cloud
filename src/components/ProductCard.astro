---
/**
 * ProductCard Component
 * Displays a digital product card with image, title, price, type, and file size
 */

import type { DigitalProduct } from '../lib/products';

interface Props {
  product: DigitalProduct;
}

const { product } = Astro.props;

// Format file size for display
const formatFileSize = (sizeMB: number): string => {
  const size = Number(sizeMB);
  if (size < 1) {
    return `${(size * 1024).toFixed(0)} KB`;
  } else if (size >= 1000) {
    return `${(size / 1024).toFixed(1)} GB`;
  } else {
    return `${size.toFixed(1)} MB`;
  }
};

// Get icon for product type
const getTypeIcon = (type: string): string => {
  switch (type) {
    case 'pdf':
      return 'ðŸ“„';
    case 'audio':
      return 'ðŸŽµ';
    case 'video':
      return 'ðŸŽ¥';
    case 'ebook':
      return 'ðŸ“š';
    default:
      return 'ðŸ“¦';
  }
};

// Get type label
const getTypeLabel = (type: string): string => {
  return type.toUpperCase();
};
---

<article
  class="flex h-full flex-col overflow-hidden rounded-xl bg-background shadow-md transition-all duration-base hover:-translate-y-1 hover:shadow-xl"
  data-product-slug={product.slug}
  data-product-id={product.id}
>
  <!-- Product Image -->
  <a href={`/products/${product.slug}`} class="group relative block aspect-video overflow-hidden">
    {product.image_url ? (
      <img
        src={product.image_url}
        alt={product.title}
        class="h-full w-full object-cover transition-transform duration-slow group-hover:scale-105"
        loading="lazy"
      />
    ) : (
      <div class="flex h-full w-full items-center justify-center bg-gradient-to-br from-primary-light/30 to-secondary-light/30">
        <span class="text-6xl">{getTypeIcon(product.product_type)}</span>
      </div>
    )}
  </a>

  <!-- Product Details -->
  <div class="flex flex-1 flex-col gap-md p-lg">
    <!-- Type Badge -->
    <div>
      <span class:list={[
        'inline-flex items-center gap-xs rounded-full px-sm py-xs text-xs font-medium',
        product.product_type === 'pdf' ? 'bg-error-light text-error' : '',
        product.product_type === 'audio' ? 'bg-info-light text-info' : '',
        product.product_type === 'video' ? 'bg-secondary-light text-secondary-dark' : '',
        product.product_type === 'ebook' ? 'bg-success-light text-success' : ''
      ]}>
        {getTypeIcon(product.product_type)} {getTypeLabel(product.product_type)}
      </span>
    </div>

    <!-- Title -->
    <a href={`/products/${product.slug}`} class="group">
      <h3 class="m-0 text-xl font-bold leading-tight text-text transition-colors duration-base group-hover:text-primary line-clamp-2">
        {product.title}
      </h3>
    </a>

    <!-- Description -->
    <p class="m-0 text-sm leading-relaxed text-text-light line-clamp-2">
      {product.description}
    </p>

    <!-- Footer: File Info, Price & CTA -->
    <div class="mt-auto flex flex-col gap-md border-t border-border pt-md">
      <div class="flex items-center justify-between">
        <!-- File Size -->
        <div class="flex items-center gap-xs text-sm text-text-light">
          <svg
            class="h-4 w-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
          <span>{formatFileSize(product.file_size_mb)}</span>
        </div>

        <!-- Price -->
        <div class="text-2xl font-bold text-primary">
          ${Number(product.price).toFixed(2)}
        </div>
      </div>

      <!-- Action Button -->
      <a
        href={`/products/${product.slug}`}
        class="block w-full whitespace-nowrap rounded-md bg-primary px-lg py-sm text-center text-sm font-semibold text-white transition-all duration-fast hover:-translate-y-0.5 hover:bg-primary-dark hover:shadow-md"
      >
        View Details
      </a>
    </div>
  </div>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
